# åŸºäºrxjsçš„çŠ¶æ€ç”Ÿæˆå™¨

**NPMåœ°å€
** [@yhfu/re-gen](https://www.npmjs.com/package/@yhfu/re-gen)  [@yhfu/re-gen-hooks](https://www.npmjs.com/package/@yhfu/re-gen-hooks)

> demoåœ°å€: https://stackblitz.com/edit/react-ts-wv4a9d?file=App.tsx,config.ts,index.html

> åˆæœŸå¼€å‘é˜¶æ®µï¼ŒAPIä¸ç¨³å®šï¼Œè°¨(ä¸)æ…(ç”¨)ä½¿(ä¹Ÿ)ç”¨(è¡Œ)ï¼

> æ­¤åº“ä¸å®šæ—¶æ›´æ–°

âœ¨ğŸŒŸâœ¨ğŸŒŸâœ¨ğŸŒŸ ***ä¾ç„¶å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œä½†æ˜¯ä¼šå°½å¿«è§£å†³ä»–ä»¬*** ğŸŒŸâœ¨ğŸŒŸâœ¨ğŸŒŸâœ¨

## ä¸ºä»€ä¹ˆä¼šæœ‰è¯¥åº“

>
æœ‰ä¸ªç®€å•çš„æƒ³æ³•ï¼Œå°±æ˜¯å°†çŠ¶æ€å¤„ç†å’Œç»„ä»¶UIåˆ†å¼€è¿›è¡Œç®¡ç†ã€‚ä¸ºäº†å®ç°è¿™ä¸ªæƒ³æ³•ï¼Œç›®å‰å°±æ˜¯å°†çŠ¶æ€å’Œå…¶å¤„ç†çš„å‡½æ•°é€šè¿‡å¯¹è±¡æ•°ç»„çš„æ–¹å¼è¿›è¡Œå£°æ˜ (
ç¬¦åˆSOLIDåŸåˆ™) ã€‚æœ‰äº†å¯¹è±¡æ•°ç»„ä¹‹åï¼Œå°±éœ€è¦æœ‰ä¸€ä¸ªç¨‹åºèƒ½å¤Ÿè§£æå¹¶è¿è¡Œå®ƒä»¬ã€‚ä¸ºæ­¤ï¼Œé€šè¿‡ä½¿ç”¨ RxJS å¹¶é€šè¿‡ç»„åˆæ“ä½œç¬¦çš„å½¢å¼è¿›è¡Œå¼€å‘ï¼Œå› æ­¤å°±è¯ç”Ÿäº†è¿™ä¸ªå°å·¥å…·ã€‚

## ä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨ï¼Ÿ

> å®ƒå¯ä»¥åº”ç”¨åˆ°å¹³æ—¶å¼€å‘ä¸­çš„ä»»ä½•åœºæ™¯ï¼Œåªæ˜¯ä¸åŒåœºæ™¯çš„æ¥å…¥æˆæœ¬ä¸åŒã€‚

è¯´æ˜ï¼šé…ç½®å¯¹è±¡ä¸­çš„ä¸€äº›ä¸“æœ‰çš„é…ç½®é¡¹ï¼ˆreduceï¼Œdistinctï¼‰æ˜¯é’ˆå¯¹ä¸“é—¨çš„åœºæ™¯ä½¿ç”¨çš„ï¼Œåœºæ™¯å¤§è‡´å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼š

- æ¯ä¸ª state å¯¹åº” UI ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œæ­¤æ—¶å°±å¯ä»¥å°†å…¶åšæˆä¸€ä¸ªå—æ§ç»„ä»¶
- å½“å‰ state æ˜¯é€šè¿‡å…¶ä»–çš„ state ç”Ÿæˆçš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä½¿ç”¨ change å›è°ƒå‡½æ•°å¯¹å…¶è¿›è¡ŒçŠ¶æ€æ›´æ”¹ï¼Œè¯¥ç±»çŠ¶æ€åˆå¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µ

  (1) è®¡ç®—ç»“æœå’Œä¸Šä¸€æ¬¡è®¡ç®—ç»“æœæ²¡æœ‰å…³ç³»ï¼Œæ­¤æ—¶ç›´æ¥è¿”å›è®¡ç®—ç»“æœå³å¯

  (2) è®¡ç®—ç»“æœå’Œä¸Šä¸€æ¬¡è®¡ç®—ç»“æœéœ€è¦è¿›è¡Œ reduce ï¼Œæ­¤æ—¶å°±éœ€è¦é…ç½® reduce é€‰é¡¹

- ç›¸é‚»ä¸¤æ¬¡ state ç›¸åŒï¼Œæ˜¯å¦éœ€è¦è¿‡æ»¤ï¼Œé»˜è®¤è¿›è¡Œè¿‡æ»¤ï¼Œä¹Ÿå¯ä»¥é…ç½® distinct ä¸º false ä¸è¿›è¡Œè¿‡æ»¤

### apps/FormFilter

è¿™æ˜¯ä¸€ä¸ªå®é™…çš„demoï¼Œä½ ä¼šå‘ç°åœ¨è¿™ç§åœºæ™¯ä¸‹å·¥å…·ä½¿ç”¨èµ·æ¥ä¼šéå¸¸çš„ä¸æ»‘ï¼Œå› ä¸ºè¿™ä¸ªå·¥å…·çš„è¯ç”Ÿå°±æ˜¯ä¸ºäº†è¿™ç§åœºæ™¯çš„éœ€æ±‚ã€‚å®ƒä¸»è¦ä»¥å¤šä¸ªä¸åŒçš„fieldä¹‹é—´è¿›è¡Œè”åŠ¨ï¼Œå…¶æ¬¡å°±æ˜¯æ¯”è¾ƒå…³é”®çš„åœ°æ–¹åœ¨äºå®ƒä»¬çš„æ•°æ®æºéƒ½æ¥è‡ªç»„ä»¶ï¼ŒåŒ…æ‹¬
change click ç­‰è¿›è¡Œé©±åŠ¨ï¼Œè¿™ä¹Ÿæ˜¯RxJSèƒ½é€‚ç”¨çš„åŸå› ä¹‹ä¸€ã€‚

### app/Form

è¿™æ˜¯ä¸€ä¸ªéå¸¸è§„çš„demoï¼Œä¸»è¦å±•ç¤ºçš„æ˜¯ä¸€ä¸ªæ•°æ®æ˜¯é€šè¿‡å…¶ä»–æ•°æ®æºé©±åŠ¨æ›´æ–°è‡ªèº«ï¼ˆreduceï¼‰çš„ä¸€ä¸ªåœºæ™¯ã€‚å› ä¸º RxJS
è‡ªèº«çš„åŸå› ï¼Œå¹¶ä¸èƒ½å¾ˆå¥½åœ°åŒºåˆ†åˆ°åº•æ˜¯å“ªä¸ªä¾èµ–äº§ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦å†™ä¸€äº›åŠŸèƒ½æ€§ï¼ˆä¾‹å¦‚å»é‡ï¼‰ä¹‹ç±»çš„ä»£ç ï¼Œæˆ–è€…æ˜¯å¼•å…¥æ–°çš„å˜é‡æ¥æ ‡è¯†å…·ä½“æ˜¯å“ªä¸ªå˜é‡å‘ç”Ÿäº†å˜åŒ–ï¼ˆç±»ä¼¼äº
redux æ´¾å‘ action ï¼‰ã€‚

### æ¥å…¥æ–¹å¼

å¦‚æœä½¿ç”¨è¯¥å·¥å…·ï¼Œéœ€è¦æä¾›ä¸€ç»„é…ç½®é¡¹ï¼Œå•ä¸ªé…ç½®é¡¹çš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼å¯ä»¥å‚ç…§ apps/demo/src/config.ts çš„é…ç½®æ–‡ä»¶ã€‚

```typescript
interface IConfigItem {
	name: string;
	init?: any;
	handle?: ( arg: any ) => ReturnResult;
	distinct?: IDistinct;
	depend?: {
		names: string[]; handle: ( args: any ) => ReturnResult; reduce?: ( pre: any, val: any ) => any; combineType?: CombineType
	};
}

type PlainResult =
	Record<string, any>
	| number
	| string
	| boolean
	| undefined
	| null;
type RxResult = ObservableInput<any>;

type ReturnResult =
	PlainResult
	| RxResult;

type IDistinct<T, K> =
	boolean
	| {
	comparator: ( previous: K, current: K ) => boolean, keySelector?: ( value: T ) => K
}

type CombineType =
	"self"
	| "any"
```

### å…·ä½“ä½¿ç”¨æ–¹æ³•

> è¯¦ç»†ä»£ç å¯å‚è€ƒ apps/demo é¡¹ç›®

- åˆ›å»ºé…ç½®é¡¹åˆ—è¡¨

```typescript
export const RelationConfig: IConfigItem[] = [{
	name: "area",
	handle( val ) {
		return [val];
	}
}, {
	name: "region",
	handle: async ( val: string[] ) => {
		return val?.filter( Boolean );
	}
}];
// å¤„ç†å‡½æ•°æ”¯æŒ async/await ä»¥åŠè¿”å› Observable çš„å½¢å¼
// å¦‚æœä½ ç†Ÿæ‚‰ RxJS çš„è¯ï¼Œé‚£å°†ä¼šæœ‰å¾ˆå¥½çš„ä½“éªŒ
```

- é€šè¿‡åŒ…å¯¼å‡ºçš„ `ReGen` æ–¹æ³•è·å– `AtomInOut` æ–¹æ³•

```typescript
const AtomInOut = ReGen( CacheKey, RelationConfig );
// è¯¥å·¥å…·é€šè¿‡ CacheKey è¿›è¡ŒåŒºåˆ†å­˜å‚¨çš„çŠ¶æ€ï¼Œç›¸åŒçš„ CacheKey ä¼šè·å–ç›¸åŒçš„çŠ¶æ€ã€‚
// å»ºè®®åœ¨ç»„ä»¶å¤–éƒ¨è¿›è¡Œè°ƒç”¨ï¼Œé¿å…é‡å¤æ¸²æŸ“ã€‚ä½†æ˜¯è¯¥å‡½æ•°åšäº†ç¼“å­˜å¤„ç†ï¼Œå†™åœ¨ç»„ä»¶é‡Œä¹Ÿä¸ä¼šé€ æˆæ€§èƒ½æµªè´¹ã€‚
```

### æ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨hookè¿›è¡Œæ“ä½œ

#### hookæ–¹æ³•

- é€šè¿‡ä½¿ç”¨ `@yhfu/ge-ren-hooks` åŒ…å¯¼å‡ºçš„ `useAtomsValue` ä»¥åŠ `useAtomsCallback` æ–¹æ³•ï¼Œåˆ†åˆ«ä¼ å…¥ `AtomInOut`
  ä»¥åŠ `RelationConfig` å‚æ•°ï¼Œhookä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡è§£æ„å¯¹è±¡ï¼Œä»è€Œè·å– `${name}` ä»¥åŠ `${name}Callback`ã€‚å…¶ä¸­ `${name}`
  ä¼šè¢«æ›¿æ¢ä¸º `RelationConfig` ä¸­çš„nameå€¼ã€‚

```typescript
const AtomInOut = ReGen( CacheKey, RelationConfig ); // å¯ä»¥å†™åˆ°ç»„ä»¶å¤–è¾¹ï¼Œä¹Ÿå¯ä»¥å†™åˆ°ç»„ä»¶å†…éƒ¨ï¼Œå®é™…é€šè¿‡ CacheKey åšäº†ç¼“å­˜çš„å¤„ç†

const {
	area,
	region
} = useAtomsValue( AtomInOut, RelationConfig );
const {
	areaCallback,
	regionCallback
} = useAtomsCallback( AtomInOut, RelationConfig );

```


