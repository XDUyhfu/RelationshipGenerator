# åŸºäºrxjsçš„çŠ¶æ€ç”Ÿæˆå™¨

**NPMåœ°å€** [@yhfu/re-gen](https://www.npmjs.com/package/@yhfu/re-gen)  [@yhfu/re-gen-hooks](https://www.npmjs.com/package/@yhfu/re-gen-hooks)

> åˆæœŸå¼€å‘é˜¶æ®µï¼ŒAPIä¸ç¨³å®šï¼Œè°¨(ä¸)æ…(ç”¨)ä½¿(ä¹Ÿ)ç”¨(è¡Œ)ï¼

> æ­¤åº“ä¸å®šæ—¶æ›´æ–°

âœ¨ğŸŒŸâœ¨ğŸŒŸâœ¨ğŸŒŸ ***ä¾ç„¶å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œä½†æ˜¯ä¼šå°½å¿«è§£å†³ä»–ä»¬*** ğŸŒŸâœ¨ğŸŒŸâœ¨ğŸŒŸâœ¨

## ä¸ºä»€ä¹ˆä¼šæœ‰è¯¥åº“
> æœ‰ä¸ªç®€å•çš„æƒ³æ³•ï¼Œå°±æ˜¯å°†çŠ¶æ€å¤„ç†å’Œç»„ä»¶UIåˆ†å¼€è¿›è¡Œç®¡ç†ã€‚ä¸ºäº†å®ç°è¿™ä¸ªæƒ³æ³•ï¼Œç›®å‰å°±æ˜¯å°†çŠ¶æ€å’Œå…¶å¤„ç†çš„å‡½æ•°é€šè¿‡é…ç½®æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œå£°æ˜ã€‚ä½†æ˜¯ç®€å•çš„å£°æ˜å¹¶ä¸èƒ½å¾ˆå¥½çš„æ»¡è¶³å¼€å‘çš„éœ€æ±‚ï¼Œå› æ­¤è¿˜éœ€è¦èƒ½å¤Ÿå¤„ç†æ•°æ®ä¹‹é—´çš„ä¾èµ–å…³ç³»ç­‰ç­‰ã€‚ä¸ºæ­¤ï¼Œé€šè¿‡ä½¿ç”¨RxJSæä¾›çš„åˆå¹¶ç±»æ“ä½œç¬¦ç­‰ï¼Œè¿›è¡Œæ•°æ®ä¾èµ–çš„å¤„ç†ã€‚æ‰€ä»¥å°±è¯ç”Ÿäº†è¿™ä¸ªå°å·¥å…·ã€‚

## ä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨ï¼Ÿ
> å…¶å®å®ƒå¯ä»¥åº”ç”¨åˆ°å¹³æ—¶å¼€å‘ä¸­çš„ä»»ä½•åœºæ™¯ï¼Œåªæ˜¯ä¸åŒåœºæ™¯çš„æ¥å…¥æˆæœ¬ä¸åŒã€‚
### apps/FormFilter
è¿™æ˜¯ä¸€ä¸ªå®é™…çš„demoï¼Œä½ ä¼šå‘ç°åœ¨è¿™ç§åœºæ™¯ä¸‹å·¥å…·ä½¿ç”¨èµ·æ¥ä¼šéå¸¸çš„ä¸æ»‘ï¼Œå› ä¸ºè¿™ä¸ªå·¥å…·çš„è¯ç”Ÿå°±æ˜¯ä¸ºäº†è¿™ç§åœºæ™¯çš„éœ€æ±‚ã€‚å®ƒä¸»è¦ä»¥å¤šä¸ªä¸åŒçš„fieldä¹‹é—´è¿›è¡Œè”åŠ¨ã€‚å…¶æ¬¡å°±æ˜¯æ¯”è¾ƒå…³é”®çš„åœ°æ–¹åœ¨äºå®ƒä»¬çš„æ•°æ®æºéƒ½æ¥è‡ªäºç»„ä»¶ï¼ŒåŒ…æ‹¬ change click ç­‰è¿›è¡Œé©±åŠ¨ï¼Œè¿™ä¹Ÿæ˜¯RxJSèƒ½é€‚ç”¨çš„åŸå› ä¹‹ä¸€ã€‚ 
### app/Form
è¿™æ˜¯ä¸€ä¸ªéå¸¸è§„çš„demoï¼Œä¸»è¦å±•ç¤ºçš„æ˜¯ä¸€ä¸ªæ•°æ®æ˜¯é€šè¿‡å…¶ä»–æ•°æ®æºé©±åŠ¨æ›´æ–°è‡ªèº«ï¼ˆreduceï¼‰çš„ä¸€ä¸ªåœºæ™¯ã€‚å› ä¸ºRxJSè‡ªèº«çš„åŸå› ï¼Œå¹¶ä¸èƒ½å¾ˆå¥½çš„åŒºåˆ†åˆ°åº•æ˜¯å“ªä¸ªä¾èµ–äº§ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦å†™ä¸€äº›åŠŸèƒ½æ€§ï¼ˆä¾‹å¦‚å»é‡ï¼‰ä¹‹ç±»çš„ä»£ç ï¼Œæˆ–è€…æ˜¯å¼•å…¥æ–°çš„å˜é‡æ¥æ ‡è¯†å…·ä½“æ˜¯å“ªä¸ªå˜é‡å‘ç”Ÿäº†å˜åŒ–ï¼ˆç±»ä¼¼äºreduxæ´¾å‘actionï¼‰ã€‚


å¦‚æœä½¿ç”¨è¯¥å·¥å…·ï¼Œéœ€è¦æä¾›ä¸€ç»„é…ç½®é¡¹ï¼Œå•ä¸ªé…ç½®é¡¹çš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼å¯ä»¥å‚ç…§ apps/demo/src/config.ts çš„é…ç½®æ–‡ä»¶ã€‚

```typescript
export interface IConfigItem {
	name: string;
	init?: any;
    // å¯¹å½“å‰å€¼è¿›è¡Œå¤„ç†
	handle?: ( arg: any ) => any;
	depend?: {
		names: string[];
        //é€šè¿‡ä¾èµ–å€¼ç”Ÿæˆæ–°çš„å€¼
		handle: ( args: any[] ) => any;
		reduce?: (pre: any, cur: any) => any
	};
}
```

### å…·ä½“ä½¿ç”¨æ–¹æ³•
> è¯¦ç»†ä»£ç å¯å‚è€ƒ apps/demo é¡¹ç›®

- åˆ›å»ºé…ç½®é¡¹åˆ—è¡¨
```typescript
export const RelationConfig: IConfigItem[] = [
	{
		name: "area",
		handle (val) { return [val]; }
	},
	{
		name: "region",
		handle async ( val: string[] ) => { return val?.filter( Boolean ); }
	}
];
// å¤„ç†å‡½æ•°æ”¯æŒ async/await ä»¥åŠè¿”å› Observable çš„å½¢å¼
// å¦‚æœä½ ç†Ÿæ‚‰ RxJS çš„è¯ï¼Œé‚£å°†ä¼šæœ‰å¾ˆå¥½çš„ä½“éªŒ
```

- é€šè¿‡åŒ…å¯¼å‡ºçš„ `ReGen` æ–¹æ³•è·å– `AtomInOut` æ–¹æ³•
```typescript
const AtomInOut = ReGen( CacheKey, RelationConfig );
// è¯¥å·¥å…·é€šè¿‡ CacheKey è¿›è¡ŒåŒºåˆ†å­˜å‚¨çš„çŠ¶æ€ï¼Œç›¸åŒçš„ CacheKey ä¼šè·å–ç›¸åŒçš„çŠ¶æ€ã€‚
// å»ºè®®åœ¨ç»„ä»¶å¤–éƒ¨è¿›è¡Œè°ƒç”¨ï¼Œé¿å…é‡å¤æ¸²æŸ“ã€‚ä½†æ˜¯è¯¥å‡½æ•°åšäº†ç¼“å­˜å¤„ç†ï¼Œå†™åœ¨ç»„ä»¶é‡Œä¹Ÿä¸ä¼šé€ æˆæ€§èƒ½æµªè´¹ã€‚
```

### æ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨hookè¿›è¡Œæ“ä½œ

#### hookæ–¹æ³•
- é€šè¿‡ä½¿ç”¨ `@yhfu/ge-ren-hooks` åŒ…å¯¼å‡ºçš„ `useAtomsValue` ä»¥åŠ `useAtomsCallback` æ–¹æ³•ï¼Œåˆ†åˆ«ä¼ å…¥ `AtomInOut` ä»¥åŠ `RelationConfig` å‚æ•°ï¼Œhookä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡è§£æ„å¯¹è±¡ï¼Œä»è€Œè·å– `${name}` ä»¥åŠ `${name}Callback`ã€‚å…¶ä¸­ `${name}` ä¼šè¢«æ›¿æ¢ä¸º `RelationConfig` ä¸­çš„nameå€¼ã€‚

```typescript
const AtomInOut = ReGen( CacheKey, RelationConfig );

const { area, region } = useAtomsValue( AtomInOut, RelationConfig );
const { areaCallback, regionCallback } = useAtomsCallback( AtomInOut, RelationConfig );
  
```